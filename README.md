# Terragrunt blueprint
This repository contains a Terragrunt blueprint with a common project structure.

## Features
- [x] AWS provider
- [x] AWS dummy module
- [x] STACKIT cloud dummy module
- [x] local backend
- [x] gitlab remote backend
- [x] STACKIT cloud s3 remote backend
- [x] override variables in env_local.hcl file
- [x] STACKIT ske kubernetes module
- [ ] STACKIT benchmark module
- [x] helm provider
- [x] kubernetes provider
- [x] helm chart module
- [ ] add some

## Apply aws dummy
```bash
export AWS_PROFILE=aws_dummy
export AWS_ACCOUNT_ID=123456789

# required if you want to use the gitlab backend
export TF_HTTP_PASSWORD=your_gitlab_token
export TF_HTTP_USERNAME=your_gitlab_user_name

cd deployments/terraform/env/dev/aws_dummy
terragrunt apply
```

## Apply stackit cloud dummy
### configure authorization
Reference: https://registry.terraform.io/providers/stackitcloud/stackit/latest/docs#authentication

Use the recommended "key flow" authentication. You should end up with two files in your home directory:

- `~/.stackit/credentials.json`
    ```json
    {
         "STACKIT_SERVICE_ACCOUNT_KEY_PATH": "/Users/<username>/.stackit/key.json"
    }
    ```
    _Note: relative paths like `~/.stackit/key.json` where not working for me._

- `~/.stackit/key.json`
  ```json
  {
      "id": "uuid",
      "publicKey": "public key",
      "createdAt": "2023-08-24T14:15:22Z",
      "validUntil": "2023-08-24T14:15:22Z",
      "keyType": "USER_MANAGED",
      "keyOrigin": "USER_PROVIDED",
      "keyAlgorithm": "RSA_2048",
      "active": true,
      "credentials": {
          "kid": "string",
          "iss": "my-sa@sa.stackit.cloud",
          "sub": "uuid",
          "aud": "string",
          (optional) "privateKey": "private key when generated by the SA service"
      }
  }
  ```
  _you can generate and download this file in the stackit cloud web console_

### s3 state backend
If you like to use the s3 state backend you need to set the bucket credentials as environment variables:
```bash
export AWS_ACCESS_KEY_ID=AAAAAAAAAAAAAAAAAAAA
export AWS_SECRET_ACCESS_KEY=BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
```

### run terragrunt
```bash
cd deployments/terraform/env/stackit_dev/stackit_dummy
terragrunt apply

# cleanup
terragrunt plan -destroy -out=destroy.tfplan
terragrunt apply destroy.tfplan
```

## Status
This repository is a work in progress.